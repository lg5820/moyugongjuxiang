<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åå¡åˆ¶ä½œå™¨ï¼ˆv2.0 éƒ­å“¥æ•‘æˆ‘QAQï¼‰</title>

  <!-- SheetJSï¼šè¯»å– xlsxï¼ˆåœ¨çº¿ç‰ˆéœ€è¦è”ç½‘ï¼›ç¦»çº¿è¯·ä¸‹è½½ xlsx.full.min.js åˆ°åŒç›®å½•å¹¶æ”¹ä¸ºæœ¬åœ°å¼•ç”¨ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      /* âœ… ç•Œé¢ï¼šç™½é‡‘è‰²ï¼ˆå›ºå®šä¸éšä¸»é¢˜å˜ï¼‰ */
      --ui-bg:#fbfbfb; --ui-bg2:#f6f3ea; --ui-panel:#fff; --ui-panel2:#fffdf6;
      --ui-text:#1f2937; --ui-muted:#6b7280; --ui-line:#e5e7eb;
      --ui-gold:#c8a24a; --ui-shadow:0 10px 26px rgba(17,24,39,.10);

      /* æ™®é€šåå¡ï¼ˆç½‘æ ¼æ¨¡å¼ï¼‰ */
      --card-w:160mm; --card-h:70mm; --card-radius:18px; --card-pad:18mm;
      --gap:12mm; --cols:1; --scale:.92;
      --name-size:56px; --slot-size:18px;

      /* âœ… ç«‹ç‰Œï¼šA4 ç«–å‘ï¼ˆ210Ã—297mmï¼‰ */
      --a4w:210mm; --a4h:297mm; --tent-scale:.86;

      /* âœ… ç«‹ç‰Œå­—å·ï¼ˆå¯è°ƒï¼‰ */
      --tent-name-size:72px;
      --tent-slot-size:20px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Noto Sans SC","Microsoft YaHei",sans-serif;
      color:var(--ui-text);
      background:
        radial-gradient(1100px 700px at 12% 6%, rgba(200,162,74,.16), transparent 60%),
        radial-gradient(900px 550px at 85% 12%, rgba(242,213,139,.18), transparent 55%),
        linear-gradient(180deg,var(--ui-bg),var(--ui-bg2));
      min-height:100vh;
    }

    header{padding:18px 18px 0;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    header h1{margin:0;font-size:18px;font-weight:900;letter-spacing:.6px}
    header .badge{font-size:12px;padding:5px 10px;border:1px solid rgba(200,162,74,.45);border-radius:999px;background:linear-gradient(180deg,#fff,#fffaf0);color:#6b4e12}

    .app{display:grid;grid-template-columns:420px 1fr;gap:14px;padding:14px 18px 18px;align-items:start}

    .panel{background:linear-gradient(180deg,var(--ui-panel),var(--ui-panel2));border:1px solid var(--ui-line);border-radius:16px;box-shadow:var(--ui-shadow);overflow:hidden}
    .panel .hd{padding:14px 14px 10px;border-bottom:1px solid var(--ui-line);display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .panel .hd h2{margin:0;font-size:14px;letter-spacing:.3px;font-weight:900}
    .panel .bd{padding:14px}

    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    label{display:block;font-size:12px;color:var(--ui-muted);margin:0 0 6px;font-weight:700}

    /* âœ… ä¸‹æ‹‰æ¡†/è¾“å…¥æ¡†ï¼šé«˜å¯¹æ¯”ï¼Œé€‰é¡¹æ¸…æ™° */
    select,input[type="number"],input[type="text"],input[type="range"]{
      width:100%;border:1px solid #d1d5db;background:#fff;color:#111827;border-radius:12px;
      padding:10px 10px;outline:none;box-shadow:0 1px 0 rgba(17,24,39,.04)
    }
    select{cursor:pointer}
    select:focus,input:focus{border-color:rgba(200,162,74,.85);box-shadow:0 0 0 4px rgba(200,162,74,.16)}
    option{color:#111827;background:#fff}
    input[type="range"]{padding:10px 8px}

    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{
      border:1px solid #d1d5db;background:linear-gradient(180deg,#fff,#fffaf0);color:#111827;border-radius:12px;
      padding:10px 12px;cursor:pointer;font-weight:900
    }
    button.primary{border-color:rgba(200,162,74,.55);background:linear-gradient(180deg,#fff4d4,#fffaf0)}
    button.danger{border-color:rgba(239,68,68,.28);background:linear-gradient(180deg,#ffe9e9,#fff)}
    button:disabled{opacity:.55;cursor:not-allowed}

    .miniBtn{
      padding:10px 10px;
      min-width:44px;
      border-radius:12px;
      font-weight:1000;
      line-height:1;
      user-select:none;
    }
    .stepper{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .stepper input[type="number"]{flex:1}

    .drop{border:1.5px dashed rgba(200,162,74,.55);border-radius:14px;padding:14px;background:rgba(255,250,240,.65);display:flex;gap:12px;align-items:center}
    .drop .icon{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;background:#fff;border:1px solid rgba(200,162,74,.35)}
    .drop .meta{flex:1}
    .drop .meta b{display:block;font-size:13px;margin-bottom:4px}
    .drop .meta span{font-size:12px;color:var(--ui-muted)}
    .hint{margin-top:10px;font-size:12px;color:var(--ui-muted);line-height:1.65}

    .mini-table{margin-top:12px;max-height:240px;overflow:auto;border:1px solid var(--ui-line);border-radius:12px;background:#fff}
    .mini-table table{width:100%;border-collapse:collapse}
    .mini-table th,.mini-table td{padding:8px 10px;border-bottom:1px solid #eef2f7;font-size:12px;text-align:left;white-space:nowrap;color:#111827}
    .mini-table th{position:sticky;top:0;background:#fffaf0}

    .pill{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid rgba(200,162,74,.35);background:linear-gradient(180deg,#fff,#fffaf0);color:#6b4e12;font-weight:800}

    .stageWrap{padding:14px}

    /* æ™®é€šåå¡é¢„è§ˆï¼ˆA4ç«–ï¼‰ */
    .paper{
      transform:scale(var(--scale));transform-origin:top left;
      width:210mm;min-height:297mm;padding:12mm;
      background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:var(--ui-shadow);position:relative;overflow:hidden
    }
    .cards{display:grid;grid-template-columns:repeat(var(--cols),var(--card-w));grid-auto-rows:var(--card-h);gap:var(--gap);align-content:start;justify-content:start}
    .cutline .card{outline:1.5px dashed rgba(200,162,74,.55);outline-offset:4px}

    /* åå¡ï¼ˆé€šç”¨ï¼‰ */
    .card{
      width:var(--card-w);height:var(--card-h);border-radius:var(--card-radius);position:relative;overflow:hidden;
      box-shadow:0 12px 22px rgba(17,24,39,.10);background:#fff;border:1px solid rgba(17,24,39,.08)
    }
    .card .inner{
      position:absolute;inset:0;padding:var(--card-pad);
      display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;gap:14px;z-index:2
    }
    .name{font-size:var(--name-size);font-weight:900;letter-spacing:2px;line-height:1.05;color:#0f172a;text-shadow:0 8px 18px rgba(17,24,39,.10)}
    .slot{
      font-size:var(--slot-size);font-weight:900;color:#111827;background:rgba(255,255,255,.92);border:1px solid rgba(17,24,39,.08);
      padding:6px 12px;border-radius:999px;display:inline-flex;gap:8px;align-items:center;box-shadow:0 8px 16px rgba(17,24,39,.08);z-index:3
    }
    .slot.small{position:absolute;bottom:10mm;left:10mm;font-size:14px;padding:5px 10px}
    .slot.tr{position:absolute;top:10mm;right:10mm;left:auto;bottom:auto}

    /* ä¸»é¢˜é€‰æ‹© */
    .tplGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .tpl{border:1px solid #e5e7eb;background:#fff;border-radius:14px;padding:10px;cursor:pointer;transition:transform .12s ease,box-shadow .12s ease;box-shadow:0 6px 14px rgba(17,24,39,.06)}
    .tpl:hover{transform:translateY(-2px)}
    .tpl.active{outline:2px solid rgba(200,162,74,.75)}
    .tpl .thumb{height:64px;border-radius:12px;border:1px solid #eef2f7;position:relative;overflow:hidden;margin-bottom:8px;background:linear-gradient(180deg,#fff,#f6fbff);display:grid;place-items:center;font-size:28px}
    .tpl .tname{font-size:12px;font-weight:900}

    /* âœ… A4 ç«–å‘ä¸‰æŠ˜ç«‹ç‰Œï¼ˆå…¨å¡«å……ï¼‰ */
    .tentPages{display:flex;flex-direction:column;gap:16px;align-items:flex-start}
    .pageA4{
      transform:scale(var(--tent-scale));transform-origin:top left;width:var(--a4w);height:var(--a4h);
      background:#fff;position:relative;overflow:hidden;border:1px solid #e5e7eb;border-radius:16px;box-shadow:var(--ui-shadow)
    }
    .triCols{position:absolute;inset:0;display:grid;grid-template-rows:1fr 1fr 1fr}
    .triCell{position:relative;display:flex;align-items:stretch;justify-content:stretch;padding:0;background:#fff;overflow:hidden}
    .triCell.blank{background:#fff}

    /* âœ… å…³é”®ï¼šåå¡é“ºæ»¡æ¯ä¸ªä¸‰ç­‰åˆ†æ ¼å­ï¼ˆæ— ç•™ç™½ï¼‰ */
    .triCell .card{width:100%;height:100%;border-radius:0;border:none;box-shadow:none}
    .triCell .name{font-size:var(--tent-name-size)}
    .triCell .slot{font-size:var(--tent-slot-size)}
    .rot180{transform:rotate(180deg);width:100%;height:100%}

    /* æŠ˜çº¿ */
    .foldLineH{position:absolute;left:0;right:0;height:0;border-top:2px dashed rgba(200,162,74,.65);pointer-events:none;z-index:5}
    .foldH1{top:calc(var(--a4h) / 3)}
    .foldH2{top:calc(var(--a4h) / 3 * 2)}

    .empty{padding:28px;border:1.5px dashed rgba(200,162,74,.55);border-radius:16px;color:var(--ui-muted);background:rgba(255,250,240,.55);line-height:1.8}

    /* âœ… æ‰“å°ï¼šéšè—æ‰€æœ‰é¢„è§ˆæ ‡é¢˜æ ï¼ˆé¿å…ä½ æˆªå›¾çš„é‚£æ¡â€œå®æ—¶é¢„è§ˆâ€¦â€ï¼‰ */
    @media print{
      body{background:#fff}
      header,.panel.left{display:none!important}
      .panel .hd{display:none!important}
      .panel{border:none!important;box-shadow:none!important;border-radius:0!important}

      .app{grid-template-columns:1fr;padding:0}
      .stageWrap{padding:0}

      .paper,.pageA4{transform:none!important;box-shadow:none!important;border:none!important;border-radius:0!important}
      .paper{width:210mm;min-height:297mm;padding:10mm}

      @page{size:A4 portrait;margin:0}
      .pageA4{width:210mm;height:297mm;page-break-after:always}

      .foldLineH{border-top:1.5px dashed rgba(0,0,0,.35)}
    }

    @media (max-width:1050px){.app{grid-template-columns:1fr}}

    /* ===== 5 ä¸ªå¡é€šä¸»é¢˜ï¼ˆåªå½±å“å¡ç‰‡ï¼‰ ===== */
    .decor{position:absolute;inset:0;z-index:1;pointer-events:none}

    /* â‘  å¤©ç©ºå½©è™¹ â˜€ï¸ğŸŒˆ */
    .t_rainbow{background:linear-gradient(180deg,#fff,#f6fbff)}
    .t_rainbow .cloud{position:absolute;width:72mm;height:32mm;background:rgba(255,255,255,.95);border-radius:999px;left:-18mm;top:-10mm;filter:drop-shadow(0 10px 18px rgba(17,24,39,.10));border:1px solid rgba(17,24,39,.05)}
    .t_rainbow .cloud:before,.t_rainbow .cloud:after{content:"";position:absolute;background:inherit;border-radius:999px;border:1px solid rgba(17,24,39,.02)}
    .t_rainbow .cloud:before{width:30mm;height:30mm;left:10mm;top:-14mm}
    .t_rainbow .cloud:after{width:38mm;height:38mm;left:28mm;top:-18mm}
    .t_rainbow .sun{position:absolute;right:10mm;top:14mm;width:22mm;height:22mm;border-radius:50%;background:radial-gradient(circle at 35% 35%,#fff7b8 0 45%,#ffd45e 46% 100%);box-shadow:0 12px 22px rgba(17,24,39,.10)}
    .t_rainbow .sun:before{content:"";position:absolute;inset:-6mm;background:repeating-conic-gradient(from 0deg,rgba(255,204,77,.75) 0 8deg,transparent 8deg 16deg);-webkit-mask:radial-gradient(circle,transparent 0 62%,#000 63%);mask:radial-gradient(circle,transparent 0 62%,#000 63%);opacity:.65}
    .t_rainbow .rainbow{position:absolute;left:-46mm;bottom:-34mm;width:150mm;height:120mm;border-radius:140mm 140mm 0 0;background:conic-gradient(from 210deg,rgba(255,0,0,.55),rgba(255,154,0,.55),rgba(255,255,0,.55),rgba(0,200,83,.55),rgba(0,145,234,.55),rgba(156,39,176,.55),rgba(255,0,0,.55));-webkit-mask:radial-gradient(circle at 50% 120%,transparent 0 55%,#000 56%);mask:radial-gradient(circle at 50% 120%,transparent 0 55%,#000 56%);opacity:.55;filter:drop-shadow(0 10px 18px rgba(17,24,39,.10))}

    /* â‘¡ å¤ªç©ºç«ç®­ ğŸš€â­ */
    .t_space{background:linear-gradient(180deg,#fff,#f7f5ff)}
    .t_space .stars{position:absolute;inset:0;background:radial-gradient(circle at 18% 22%,rgba(121,80,255,.18) 0 3px,transparent 4px),radial-gradient(circle at 30% 70%,rgba(121,80,255,.18) 0 2px,transparent 3px),radial-gradient(circle at 72% 30%,rgba(33,150,243,.18) 0 3px,transparent 4px),radial-gradient(circle at 82% 72%,rgba(33,150,243,.18) 0 2px,transparent 3px);opacity:.9}
    .t_space .planet{position:absolute;left:-28mm;bottom:-26mm;width:90mm;height:90mm;border-radius:50%;background:radial-gradient(circle at 35% 35%,#d8c9ff 0 45%,#b39cff 46% 100%);box-shadow:0 18px 26px rgba(17,24,39,.10);opacity:.85}
    .t_space .ring{position:absolute;left:-36mm;bottom:-8mm;width:120mm;height:42mm;border-radius:999px;border:6px solid rgba(121,80,255,.18);transform:rotate(-12deg);opacity:.85}
    .t_space .rocket{position:absolute;right:8mm;top:10mm;width:26mm;height:26mm;border-radius:10px;background:linear-gradient(180deg,#fff,#f2f2ff);border:1px solid rgba(17,24,39,.08);transform:rotate(18deg);box-shadow:0 10px 18px rgba(17,24,39,.10)}
    .t_space .rocket:before{content:"";position:absolute;left:7mm;top:-7mm;width:12mm;height:12mm;border-radius:999px;background:radial-gradient(circle at 40% 40%,#ffb3c1 0 55%,#ff6f91 56% 100%)}
    .t_space .rocket:after{content:"";position:absolute;left:-10mm;top:10mm;width:20mm;height:6mm;border-radius:999px;background:linear-gradient(90deg,rgba(255,209,102,0),rgba(255,209,102,.55),rgba(255,209,102,0));filter:blur(.3mm);opacity:.85}

    /* â‘¢ æµ·åº•å°é±¼ ğŸŸğŸ«§ */
    .t_ocean{background:linear-gradient(180deg,#fff,#f2fbff)}
    .t_ocean .waves{position:absolute;left:-40mm;bottom:-40mm;width:180mm;height:140mm;border-radius:140mm 140mm 0 0;background:conic-gradient(from 210deg,rgba(0,145,234,.30),rgba(0,200,255,.22),rgba(0,145,234,.30));-webkit-mask:radial-gradient(circle at 50% 120%,transparent 0 55%,#000 56%);mask:radial-gradient(circle at 50% 120%,transparent 0 55%,#000 56%);opacity:.75}
    .t_ocean .bubble{position:absolute;border-radius:50%;background:radial-gradient(circle at 35% 35%,rgba(255,255,255,.95),rgba(255,255,255,.05));border:1px solid rgba(0,145,234,.12);box-shadow:0 10px 18px rgba(17,24,39,.06);opacity:.85}
    .t_ocean .b1{width:14mm;height:14mm;right:10mm;top:16mm}
    .t_ocean .b2{width:10mm;height:10mm;right:26mm;top:32mm}
    .t_ocean .b3{width:8mm;height:8mm;right:14mm;top:44mm}
    .t_ocean .fish{position:absolute;left:10mm;top:14mm;width:22mm;height:12mm;border-radius:999px;background:radial-gradient(circle at 35% 35%,#ffd6a5 0 50%,#ff9f1c 51% 100%);box-shadow:0 12px 20px rgba(17,24,39,.08);transform:rotate(-10deg);opacity:.95}
    .t_ocean .fish:before{content:"";position:absolute;right:-10mm;top:2mm;width:10mm;height:8mm;background:rgba(255,159,28,.85);border-radius:2mm 8mm 8mm 2mm;transform:rotate(18deg)}
    .t_ocean .fish:after{content:"";position:absolute;left:6mm;top:4mm;width:2.2mm;height:2.2mm;border-radius:50%;background:rgba(17,24,39,.65)}

    /* â‘£ æ£®æ—å°ç†Š ğŸ»ğŸŒ¿ */
    .t_forest{background:linear-gradient(180deg,#fff,#f6fff5)}
    .t_forest .leaf{position:absolute;width:26mm;height:18mm;border-radius:26mm 26mm 26mm 0;background:radial-gradient(circle at 35% 35%,#b7f7c2 0 50%,#34d399 51% 100%);opacity:.75;transform:rotate(-18deg);filter:drop-shadow(0 12px 18px rgba(17,24,39,.08))}
    .t_forest .l1{left:-8mm;top:10mm}
    .t_forest .l2{right:-10mm;bottom:8mm;transform:rotate(22deg);opacity:.55}
    .t_forest .bear{position:absolute;right:12mm;top:14mm;width:20mm;height:20mm;border-radius:50%;background:radial-gradient(circle at 35% 35%,#ffe9c7 0 48%,#c0841d 49% 100%);box-shadow:0 12px 18px rgba(17,24,39,.10);opacity:.9}
    .t_forest .bear:before,.t_forest .bear:after{content:"";position:absolute;width:8mm;height:8mm;border-radius:50%;background:rgba(192,132,29,.92);top:-2mm}
    .t_forest .bear:before{left:1mm}
    .t_forest .bear:after{right:1mm}

    /* â‘¤ ç³–æœæ´¾å¯¹ ğŸ¬ğŸ­ */
    .t_candy{background:linear-gradient(180deg,#fff,#fff3fb)}
    .t_candy .sprinkle{position:absolute;width:5mm;height:2mm;border-radius:999px;opacity:.85;filter:drop-shadow(0 8px 12px rgba(17,24,39,.08))}
    .t_candy .s1{left:12mm;top:12mm;background:#ff6f91;transform:rotate(18deg)}
    .t_candy .s2{left:22mm;top:22mm;background:#7c3aed;transform:rotate(-20deg)}
    .t_candy .s3{left:36mm;top:14mm;background:#06b6d4;transform:rotate(12deg)}
    .t_candy .s4{right:26mm;bottom:18mm;background:#f59e0b;transform:rotate(-14deg)}
    .t_candy .s5{right:14mm;bottom:30mm;background:#22c55e;transform:rotate(22deg)}
    .t_candy .lolli{position:absolute;right:12mm;top:10mm;width:18mm;height:18mm;border-radius:50%;background:conic-gradient(from 0deg,#ff6f91,#ffd166,#06b6d4,#a78bfa,#ff6f91);box-shadow:0 12px 18px rgba(17,24,39,.10);opacity:.9}
    .t_candy .stick{position:absolute;right:19mm;top:26mm;width:2mm;height:18mm;border-radius:999px;background:rgba(17,24,39,.12);opacity:.9;transform:rotate(18deg)}
  </style>
</head>
<body>
  <header>
    <h1>åå¡åˆ¶ä½œå™¨ï¼ˆå­¦ç§‘å‡ºå“ï¼Œéƒ­å“¥æ•‘æˆ‘QAQï¼‰</h1>
    <span class="badge">ç™½é‡‘ç•Œé¢ï½œä¸Šä¼  xlsx â†’ ç¬¬1åˆ—(å§“å)+ç¬¬2åˆ—(æ—¶æ®µ) â†’ A4ç«–å‘ä¸‰æŠ˜ç«‹ç‰Œï¼ˆä¸Š/ä¸­åå¡å…¨å¡«å……ï¼Œä¸‹ç©ºç™½ï¼‰</span>
  </header>

  <div class="app">
    <!-- å·¦ä¾§ï¼šè®¾ç½® -->
    <section class="panel left">
      <div class="hd">
        <h2>â‘  å¯¼å…¥æ•°æ®</h2>
        <span class="pill" id="countPill">0 æ¡</span>
      </div>
      <div class="bd">
        <div class="drop" id="dropZone">
          <div class="icon">ğŸ“„</div>
          <div class="meta"><b>æ‹–æ‹½ xlsx åˆ°è¿™é‡Œ</b><span>æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ï¼ˆåªè¯»å–ç¬¬1/2åˆ—ï¼‰</span></div>
          <input id="fileInput" type="file" accept=".xlsx,.xls" style="display:none" />
          <button class="primary" id="pickBtn">é€‰æ‹©æ–‡ä»¶</button>
        </div>

        <div class="hint">
          âœ… è¡¨æ ¼ï¼šç¬¬1åˆ—=å§“åï¼Œç¬¬2åˆ—=æ—¶æ®µï¼›è‹¥ç¬¬ä¸€è¡Œæ˜¯è¡¨å¤´ä¼šè‡ªåŠ¨è·³è¿‡ã€‚<br/>
          ğŸ–¨ï¸ å¯¼å‡º PDF æƒ³è¦å½©è‰²èƒŒæ™¯ï¼šè¯·åœ¨æ‰“å°å¯¹è¯æ¡†å‹¾é€‰ <b>â€œèƒŒæ™¯å›¾å½¢â€</b>ï¼ˆChrome é»˜è®¤ä¸å‹¾ä¼šå˜â€œé»‘ç™½/çº¯ç™½â€ï¼‰ã€‚
        </div>

        <div class="mini-table" id="miniTable" style="display:none">
          <table><thead><tr><th>#</th><th>å§“å</th><th>æ—¶æ®µ</th></tr></thead><tbody id="miniTbody"></tbody></table>
        </div>

        <div style="height:14px"></div>

        <div class="panel" style="background:#fff;border-radius:14px;border:1px solid #e5e7eb;box-shadow:0 8px 18px rgba(17,24,39,.06);">
          <div class="hd" style="border-bottom:1px solid #eef2f7">
            <h2>â‘¡ è¾“å‡ºæ¨¡å¼</h2>
            <span class="pill" id="modePill">A4ä¸‰æŠ˜ç«‹ç‰Œï¼ˆç«–å‘ï¼‰</span>
          </div>
          <div class="bd">
            <div class="grid2">
              <div>
                <label>æ‰“å°ç±»å‹</label>
                <select id="modeSel">
                  <option value="tent">A4 ä¸‰æŠ˜ç«‹ç‰Œï¼ˆç«–å‘ï¼šä¸Š/ä¸­åå¡ï¼Œä¸‹ç©ºç™½ï¼‰</option>
                  <option value="grid">æ™®é€šåå¡ï¼ˆA4 ç«–å‘æ’ç‰ˆï¼‰</option>
                </select>
              </div>
              <div>
                <label>ç«‹ç‰Œé¢„è§ˆç¼©æ”¾</label>
                <input id="tentScale" type="range" min="0.55" max="1" step="0.01" value="0.86" />
              </div>
            </div>

            <div style="height:10px"></div>

            <div class="grid2">
              <div>
                <label>æ—¶æ®µä½ç½®</label>
                <select id="slotPos">
                  <option value="tr">å³ä¸Š</option>
                  <option value="bl">å·¦ä¸‹</option>
                  <option value="center">å±…ä¸­ï¼ˆå§“åä¸‹æ–¹ï¼‰</option>
                </select>
              </div>
              <div>
                <label>ç«‹ç‰Œï¼šä¸ŠåŠå¼ æ—‹è½¬</label>
                <select id="rotSel">
                  <option value="on">å¼€å¯ï¼ˆä¸Šé¢å€’ç€/ä¸‹é¢æ­£ç€ï¼‰</option>
                  <option value="off">å…³é—­</option>
                </select>
              </div>
            </div>

            <div style="height:12px"></div>

            <!-- âœ… æ–°å¢ï¼šå­—å·æŒ‰é’®ï¼ˆç«‹ç‰Œï¼‰ -->
            <div class="panel" style="background:#fff;border-radius:14px;border:1px solid #eef2f7;box-shadow:none">
              <div class="hd" style="border-bottom:1px solid #eef2f7">
                <h2>å­—å·å¿«æ·æŒ‰é’®ï¼ˆç«‹ç‰Œï¼‰</h2>
                <span class="pill">Â±2</span>
              </div>
              <div class="bd">
                <div class="grid2">
                  <div>
                    <label>å§“åå­—å·(px)</label>
                    <div class="stepper">
                      <button class="miniBtn" id="tnMinus" type="button">ï¼</button>
                      <input id="tentNameSize" type="number" min="28" max="140" value="72" />
                      <button class="miniBtn" id="tnPlus" type="button">ï¼‹</button>
                    </div>
                  </div>
                  <div>
                    <label>æ—¶æ®µå­—å·(px)</label>
                    <div class="stepper">
                      <button class="miniBtn" id="tsMinus" type="button">ï¼</button>
                      <input id="tentSlotSize" type="number" min="12" max="80" value="20" />
                      <button class="miniBtn" id="tsPlus" type="button">ï¼‹</button>
                    </div>
                  </div>
                </div>
                <div class="hint">è¿™ä¸¤ä¸ªåªå½±å“ <b>A4ä¸‰æŠ˜ç«‹ç‰Œ</b> é¢„è§ˆ/æ‰“å°ã€‚</div>
              </div>
            </div>

            <div class="hint">ğŸ–¨ï¸ æ‰“å°å»ºè®®ï¼šA4 çºµå‘ï¼›ç¼©æ”¾é€‰â€œé€‚åˆé¡µé¢/é»˜è®¤â€ã€‚</div>
          </div>
        </div>

        <div style="height:14px"></div>

        <div class="panel" style="background:#fff;border-radius:14px;border:1px solid #e5e7eb;box-shadow:0 8px 18px rgba(17,24,39,.06);">
          <div class="hd" style="border-bottom:1px solid #eef2f7"><h2>â‘¢ é€‰æ‹©ä¸»é¢˜ï¼ˆ5æ¬¾å¡é€šï¼‰</h2><span class="pill" id="tplPill">ä¸»é¢˜ï¼šå¤©ç©ºå½©è™¹</span></div>
          <div class="bd">
            <div class="tplGrid" id="tplGrid"></div>
            <div class="hint">ï¼ˆä¸»é¢˜åªå½±å“â€œåå¡â€ï¼Œç•Œé¢ä¸€ç›´ç™½é‡‘è‰²ï¼‰</div>
          </div>
        </div>

        <div style="height:14px"></div>

        <div class="panel" id="gridSettings" style="background:#fff;border-radius:14px;border:1px solid #e5e7eb;box-shadow:0 8px 18px rgba(17,24,39,.06);">
          <div class="hd" style="border-bottom:1px solid #eef2f7"><h2>â‘£ æ™®é€šåå¡è®¾ç½®ï¼ˆä»…â€œæ™®é€šåå¡â€æ¨¡å¼ä½¿ç”¨ï¼‰</h2><span class="pill">A4 ç«–å‘</span></div>
          <div class="bd">
            <div class="grid2">
              <div><label>æ¯é¡µåˆ—æ•°</label><select id="colsSel"><option value="1">1 åˆ—</option><option value="2">2 åˆ—</option><option value="3">3 åˆ—</option></select></div>
              <div><label>è£åˆ‡è™šçº¿</label><select id="cutSel"><option value="on">å¼€å¯</option><option value="off">å…³é—­</option></select></div>
            </div>

            <div style="height:10px"></div>

            <div class="grid3">
              <div><label>åå¡å®½(mm)</label><input id="cw" type="number" min="40" max="210" value="160" /></div>
              <div><label>åå¡é«˜(mm)</label><input id="ch" type="number" min="30" max="140" value="70" /></div>
              <div><label>é—´è·(mm)</label><input id="gap" type="number" min="0" max="30" value="12" /></div>
            </div>

            <div style="height:10px"></div>

            <!-- âœ… æ–°å¢ï¼šå­—å·æŒ‰é’®ï¼ˆæ™®é€šåå¡ï¼‰ -->
            <div class="grid2">
              <div>
                <label>å§“åå­—å·(px)</label>
                <div class="stepper">
                  <button class="miniBtn" id="gnMinus" type="button">ï¼</button>
                  <input id="ns" type="number" min="18" max="140" value="56" />
                  <button class="miniBtn" id="gnPlus" type="button">ï¼‹</button>
                </div>
              </div>
              <div>
                <label>æ—¶æ®µå­—å·(px)</label>
                <div class="stepper">
                  <button class="miniBtn" id="gsMinus" type="button">ï¼</button>
                  <input id="ss" type="number" min="10" max="60" value="18" />
                  <button class="miniBtn" id="gsPlus" type="button">ï¼‹</button>
                </div>
              </div>
            </div>

            <div style="height:10px"></div>

            <div>
              <label>æ™®é€šåå¡é¢„è§ˆç¼©æ”¾</label>
              <input id="scale" type="range" min="0.45" max="1" step="0.01" value="0.92" />
            </div>
          </div>
        </div>

        <div style="height:14px"></div>

        <div class="btns">
          <button class="primary" id="printBtn" disabled>ğŸ–¨ï¸ æ‰“å° / å¯¼å‡º PDF</button>
          <button id="clearBtn" class="danger" disabled>ğŸ§¹ æ¸…ç©º</button>
          <button id="demoBtn" type="button">âœ¨ å¡«å……æ¼”ç¤ºæ•°æ®</button>
        </div>

        <div class="hint">
          ğŸ“Œ å¯¼å‡º PDF å½©è‰²ï¼š<b>ä¸€å®šå‹¾é€‰</b> æ‰“å°å¯¹è¯æ¡†çš„ <b>â€œèƒŒæ™¯å›¾å½¢â€</b> âœ…<br/>
          å¦‚æœä»é»‘ç™½ï¼šå»â€œæ›´å¤šè®¾ç½®/æ›´å¤šé€‰é¡¹â€é‡ŒæŠŠâ€œé¢œè‰²â€æ”¹æˆâ€œå½©è‰²â€ï¼Œä¸è¦â€œç°åº¦/é»‘ç™½â€ã€‚
        </div>
      </div>
    </section>

    <!-- å³ä¾§ï¼šé¢„è§ˆ -->
    <section class="panel">
      <div class="hd">
        <h2>å®æ—¶é¢„è§ˆï¼ˆå¯ç›´æ¥æ‰“å°ï¼‰</h2>
        <div><span class="pill" id="sheetPill">å·¥ä½œè¡¨ï¼šâ€”</span><span class="pill">è¯»å–ï¼šç¬¬1/2åˆ—</span></div>
      </div>

      <div class="stageWrap">
        <div class="empty" id="emptyState">
          è¿™é‡Œä¼šæ˜¾ç¤ºé¢„è§ˆ ğŸ‘€<br/>
          â‘  ä¸Šä¼  xlsxï¼ˆç¬¬1åˆ—=å§“åï¼Œç¬¬2åˆ—=æ—¶æ®µï¼‰<br/>
          â‘¡ é»˜è®¤ï¼šA4ç«–å‘ä¸‰æŠ˜ç«‹ç‰Œï¼ˆä¸Š/ä¸­åå¡å…¨å¡«å……ï¼Œä¸‹ç©ºç™½ï¼‰
        </div>

        <div class="paper cutline" id="gridPaper" style="display:none">
          <div class="cards" id="cards" style="display:none"></div>
        </div>

        <div class="tentPages" id="tentPages" style="display:none"></div>
      </div>
    </section>
  </div>

<script>
  const state = { template:'rainbow', rows:[], sheetName:'', mode:'tent', rotTop:'on' };

  const TEMPLATES = [
    { id:'rainbow', name:'å¤©ç©ºå½©è™¹', cls:'t_rainbow', thumb:'ğŸŒˆ' },
    { id:'space',   name:'å¤ªç©ºç«ç®­', cls:'t_space',   thumb:'ğŸš€' },
    { id:'ocean',   name:'æµ·åº•å°é±¼', cls:'t_ocean',   thumb:'ğŸŸ' },
    { id:'forest',  name:'æ£®æ—å°ç†Š', cls:'t_forest',  thumb:'ğŸ»' },
    { id:'candy',   name:'ç³–æœæ´¾å¯¹', cls:'t_candy',   thumb:'ğŸ¬' },
  ];

  const $ = (id)=> document.getElementById(id);

  const fileInput = $('fileInput');
  const pickBtn = $('pickBtn');
  const dropZone = $('dropZone');

  const modeSel = $('modeSel');
  const modePill = $('modePill');

  const tplGrid = $('tplGrid');
  const tplPill = $('tplPill');

  const gridSettings = $('gridSettings');
  const colsSel = $('colsSel');
  const cutSel = $('cutSel');
  const cw = $('cw');
  const ch = $('ch');
  const gap = $('gap');
  const ns = $('ns');
  const ss = $('ss');
  const scale = $('scale');

  const slotPos = $('slotPos');
  const tentScale = $('tentScale');
  const rotSel = $('rotSel');

  // âœ… ç«‹ç‰Œå­—å·è¾“å…¥
  const tentNameSize = $('tentNameSize');
  const tentSlotSize = $('tentSlotSize');

  const printBtn = $('printBtn');
  const clearBtn = $('clearBtn');
  const demoBtn = $('demoBtn');

  const countPill = $('countPill');
  const sheetPill = $('sheetPill');

  const miniTable = $('miniTable');
  const miniTbody = $('miniTbody');

  const emptyState = $('emptyState');
  const gridPaper = $('gridPaper');
  const cardsEl = $('cards');
  const tentPages = $('tentPages');

  function escapeHtml(s){
    return String(s ?? '')
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#39;');
  }

  function renderTemplatePicker(){
    tplGrid.innerHTML = '';
    for(const t of TEMPLATES){
      const el = document.createElement('div');
      el.className = 'tpl' + (t.id === state.template ? ' active' : '');

      const thumb = document.createElement('div');
      thumb.className = 'thumb';
      thumb.textContent = t.thumb;

      const name = document.createElement('div');
      name.className = 'tname';
      name.textContent = t.name;

      el.appendChild(thumb);
      el.appendChild(name);

      el.addEventListener('click', ()=>{
        state.template = t.id;
        tplPill.textContent = 'ä¸»é¢˜ï¼š' + t.name;
        renderTemplatePicker();
        renderAll();
      });

      tplGrid.appendChild(el);
    }
  }

  async function readXlsx(file){
    const arrayBuffer = await file.arrayBuffer();
    const wb = XLSX.read(arrayBuffer, { type: 'array' });
    const sheetName = wb.SheetNames[0];
    const ws = wb.Sheets[sheetName];

    const data = XLSX.utils.sheet_to_json(ws, { header: 1, raw: false, defval: '' });
    const rows = data
      .map(r => [String(r[0] ?? '').trim(), String(r[1] ?? '').trim()])
      .filter(([a,b]) => a || b);

    const header0 = (rows[0]?.[0] || '').replace(/\s/g,'');
    const header1 = (rows[0]?.[1] || '').replace(/\s/g,'');
    const looksHeader = /å§“å|åå­—|å­¦ç”Ÿ|å­¦å‘˜/i.test(header0) && /æ—¶æ®µ|æ—¶é—´|ä¸Šè¯¾|ç­æ¬¡/i.test(header1);

    const body = looksHeader ? rows.slice(1) : rows;

    state.sheetName = sheetName;
    state.rows = body.map(([name, slot]) => ({ name, slot })).filter(x => x.name);

    updateMiniTable();
    updatePills();
    renderAll();
  }

  function updatePills(){
    countPill.textContent = `${state.rows.length} æ¡`;
    sheetPill.textContent = `å·¥ä½œè¡¨ï¼š${state.sheetName || 'â€”'}`;
    printBtn.disabled = state.rows.length === 0;
    clearBtn.disabled = state.rows.length === 0;
  }

  function updateMiniTable(){
    if(state.rows.length === 0){
      miniTable.style.display = 'none';
      miniTbody.innerHTML = '';
      return;
    }
    miniTable.style.display = 'block';
    miniTbody.innerHTML = '';
    const max = Math.min(40, state.rows.length);
    for(let i=0;i<max;i++){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${i+1}</td><td>${escapeHtml(state.rows[i].name)}</td><td>${escapeHtml(state.rows[i].slot)}</td>`;
      miniTbody.appendChild(tr);
    }
  }

  function buildCard(nameText, slotText){
    const card = document.createElement('div');
    card.className = 'card';

    const t = TEMPLATES.find(x=>x.id===state.template) || TEMPLATES[0];
    card.classList.add(t.cls);

    const decor = document.createElement('div');
    decor.className = 'decor';

    if(t.id === 'rainbow') decor.innerHTML = `<div class="cloud"></div><div class="sun"></div><div class="rainbow"></div>`;
    if(t.id === 'space')   decor.innerHTML = `<div class="stars"></div><div class="planet"></div><div class="ring"></div><div class="rocket"></div>`;
    if(t.id === 'ocean')   decor.innerHTML = `<div class="waves"></div><div class="fish"></div><div class="bubble b1"></div><div class="bubble b2"></div><div class="bubble b3"></div>`;
    if(t.id === 'forest')  decor.innerHTML = `<div class="leaf l1"></div><div class="leaf l2"></div><div class="bear"></div>`;
    if(t.id === 'candy')   decor.innerHTML = `<div class="sprinkle s1"></div><div class="sprinkle s2"></div><div class="sprinkle s3"></div><div class="sprinkle s4"></div><div class="sprinkle s5"></div><div class="lolli"></div><div class="stick"></div>`;

    const inner = document.createElement('div');
    inner.className = 'inner';

    const name = document.createElement('div');
    name.className = 'name';
    name.textContent = nameText;

    const slot = document.createElement('div');
    slot.className = 'slot';
    slot.textContent = slotText || '';

    const pos = slotPos.value;
    if(pos === 'center'){
      inner.appendChild(name);
      if(slotText) inner.appendChild(slot);
    }else{
      inner.appendChild(name);
      if(slotText){
        slot.classList.add('small');
        if(pos === 'tr') slot.classList.add('tr');
      }
    }

    card.appendChild(decor);
    card.appendChild(inner);
    if(pos !== 'center' && slotText) card.appendChild(slot);

    return card;
  }

  function renderGrid(){
    gridPaper.style.display = 'block';
    tentPages.style.display = 'none';

    if(state.rows.length === 0){
      cardsEl.style.display = 'none';
      cardsEl.innerHTML = '';
      return;
    }

    cardsEl.style.display = 'grid';
    cardsEl.innerHTML = '';
    for(const row of state.rows) cardsEl.appendChild(buildCard(row.name, row.slot));
  }

  function renderTent(){
    gridPaper.style.display = 'none';
    tentPages.style.display = 'flex';

    tentPages.innerHTML = '';
    if(state.rows.length === 0) return;

    for(const row of state.rows){
      const page = document.createElement('div');
      page.className = 'pageA4';

      const grid = document.createElement('div');
      grid.className = 'triCols';

      const top = document.createElement('div');
      top.className = 'triCell';
      const topWrap = document.createElement('div');
      topWrap.style.width = '100%';
      topWrap.style.height = '100%';
      if(state.rotTop === 'on') topWrap.className = 'rot180';
      topWrap.appendChild(buildCard(row.name, row.slot));
      top.appendChild(topWrap);

      const mid = document.createElement('div');
      mid.className = 'triCell';
      mid.appendChild(buildCard(row.name, row.slot));

      const bot = document.createElement('div');
      bot.className = 'triCell blank';

      grid.appendChild(top);
      grid.appendChild(mid);
      grid.appendChild(bot);

      const f1 = document.createElement('div'); f1.className = 'foldLineH foldH1';
      const f2 = document.createElement('div'); f2.className = 'foldLineH foldH2';

      page.appendChild(grid);
      page.appendChild(f1);
      page.appendChild(f2);

      tentPages.appendChild(page);
    }
  }

  function applyLayout(){
    // ç½‘æ ¼æ¨¡å¼å˜é‡
    document.documentElement.style.setProperty('--cols', colsSel.value);
    document.documentElement.style.setProperty('--card-w', `${Number(cw.value || 160)}mm`);
    document.documentElement.style.setProperty('--card-h', `${Number(ch.value || 70)}mm`);
    document.documentElement.style.setProperty('--gap', `${Number(gap.value || 12)}mm`);
    document.documentElement.style.setProperty('--name-size', `${Number(ns.value || 56)}px`);
    document.documentElement.style.setProperty('--slot-size', `${Number(ss.value || 18)}px`);
    document.documentElement.style.setProperty('--scale', String(scale.value || 0.92));

    const pad = Math.max(10, Math.min(22, Math.round(Number(ch.value || 70) * 0.22)));
    document.documentElement.style.setProperty('--card-pad', `${pad}mm`);

    gridPaper.classList.toggle('cutline', cutSel.value === 'on');

    // ç«‹ç‰Œç¼©æ”¾ + ç«‹ç‰Œå­—å·
    document.documentElement.style.setProperty('--tent-scale', String(tentScale.value || 0.86));
    document.documentElement.style.setProperty('--tent-name-size', `${Number(tentNameSize.value || 72)}px`);
    document.documentElement.style.setProperty('--tent-slot-size', `${Number(tentSlotSize.value || 20)}px`);
  }

  function applyMode(){
    state.mode = modeSel.value;
    state.rotTop = rotSel.value;
    modePill.textContent = (state.mode === 'tent') ? 'A4ä¸‰æŠ˜ç«‹ç‰Œï¼ˆç«–å‘ï¼‰' : 'æ™®é€šåå¡';
    const isGrid = state.mode === 'grid';
    gridSettings.style.display = isGrid ? 'block' : 'none';
    renderAll();
  }

  function renderAll(){
    applyLayout();
    if(state.rows.length === 0){
      emptyState.style.display = 'block';
      gridPaper.style.display = 'none';
      tentPages.style.display = 'none';
      return;
    }
    emptyState.style.display = 'none';
    if(state.mode === 'tent') renderTent();
    else renderGrid();
  }

  // âœ… å­—å·æŒ‰é’®é€»è¾‘
  function bumpNumber(inputEl, delta){
    const min = Number(inputEl.min || -1e9);
    const max = Number(inputEl.max ||  1e9);
    const cur = Number(inputEl.value || 0);
    const next = Math.max(min, Math.min(max, cur + delta));
    inputEl.value = String(next);
    inputEl.dispatchEvent(new Event('input', {bubbles:true}));
  }

  // ç«‹ç‰Œå­—å·æŒ‰é’®
  $('tnMinus').addEventListener('click', ()=> bumpNumber(tentNameSize, -2));
  $('tnPlus').addEventListener('click',  ()=> bumpNumber(tentNameSize, +2));
  $('tsMinus').addEventListener('click', ()=> bumpNumber(tentSlotSize, -2));
  $('tsPlus').addEventListener('click',  ()=> bumpNumber(tentSlotSize, +2));

  // æ™®é€šåå¡å­—å·æŒ‰é’®
  $('gnMinus').addEventListener('click', ()=> bumpNumber(ns, -2));
  $('gnPlus').addEventListener('click',  ()=> bumpNumber(ns, +2));
  $('gsMinus').addEventListener('click', ()=> bumpNumber(ss, -2));
  $('gsPlus').addEventListener('click',  ()=> bumpNumber(ss, +2));

  // æ–‡ä»¶å¯¼å…¥
  pickBtn.addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', async (e)=>{
    const file = e.target.files?.[0];
    if(!file) return;
    await readXlsx(file);
  });

  // æ‹–æ‹½
  ['dragenter','dragover'].forEach(evt=>{
    dropZone.addEventListener(evt, (e)=>{ e.preventDefault(); dropZone.style.background = 'rgba(255,250,240,.85)'; });
  });
  ['dragleave','drop'].forEach(evt=>{
    dropZone.addEventListener(evt, (e)=>{ e.preventDefault(); dropZone.style.background = 'rgba(255,250,240,.65)'; });
  });
  dropZone.addEventListener('drop', async (e)=>{
    const file = e.dataTransfer?.files?.[0];
    if(!file) return;
    if(!/\.(xlsx|xls)$/i.test(file.name)){ alert('è¯·æ‹–æ‹½ .xlsx æˆ– .xls æ–‡ä»¶'); return; }
    await readXlsx(file);
  });

  // å˜æ›´ç›‘å¬
  modeSel.addEventListener('change', applyMode);
  rotSel.addEventListener('change', applyMode);

  [colsSel, cutSel, cw, ch, gap, ns, ss, scale, slotPos, tentScale, tentNameSize, tentSlotSize].forEach(el=>{
    el.addEventListener('input', renderAll);
    el.addEventListener('change', renderAll);
  });

  // æ‰“å°
  printBtn.addEventListener('click', ()=> window.print());

  // æ¸…ç©º
  clearBtn.addEventListener('click', ()=>{
    state.rows = [];
    state.sheetName = '';
    fileInput.value = '';
    updateMiniTable(); updatePills(); renderAll();
  });

  // æ¼”ç¤º
  demoBtn.addEventListener('click', ()=>{
    state.sheetName = 'æ¼”ç¤ºæ•°æ®';
    state.rows = [
      {name:'éƒ­æ€ç¾½', slot:'12:00-14:30'},
      {name:'çš®å…†éºŸ', slot:'äºŒæœŸ 08:30-11:00'},
      {name:'éƒ‘æ¢¦æºª', slot:'12:00-14:30'},
    ];
    updateMiniTable(); updatePills(); renderAll();
  });

  // åˆå§‹åŒ–
  renderTemplatePicker();
  tplPill.textContent = 'ä¸»é¢˜ï¼šå¤©ç©ºå½©è™¹';
  applyMode();
  updatePills();
</script>
</body>
</html>
